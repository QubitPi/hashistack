"use strict";(self.webpackChunkhashicorp_aws=self.webpackChunkhashicorp_aws||[]).push([[1398],{4351:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var t=n(3860),i=n(5639);const r={slug:"cypress-e2e",title:"Cypress E2E Tests",authors:["jiaqi"],tags:["CI/CD","GitHub","Frontend"]},a=void 0,o={permalink:"/blog/cypress-e2e",editUrl:"https://github.com/QubitPi/hashistack/tree/master/docs/blog/2024-04-14-cypress-e2e.md",source:"@site/blog/2024-04-14-cypress-e2e.md",title:"Cypress E2E Tests",description:"This action assumes the yarn package manager is used.",date:"2024-04-14T00:00:00.000Z",formattedDate:"April 14, 2024",tags:[{label:"CI/CD",permalink:"/blog/tags/ci-cd"},{label:"GitHub",permalink:"/blog/tags/git-hub"},{label:"Frontend",permalink:"/blog/tags/frontend"}],readingTime:1.865,hasTruncateMarker:!1,authors:[{name:"Jiaqi Liu",title:"Maintainer of hashicorp-aws",url:"https://github.com/QubitPi",imageURL:"https://avatars.githubusercontent.com/u/16126939?v=4",key:"jiaqi"}],frontMatter:{slug:"cypress-e2e",title:"Cypress E2E Tests",authors:["jiaqi"],tags:["CI/CD","GitHub","Frontend"]},unlisted:!1,prevItem:{title:"Bumping Semantic Version by GitHub Tag",permalink:"/blog/version-bump"},nextItem:{title:"Setting up JDK in GitHub Actions",permalink:"/blog/jdk-setup"}},l={authorsImageUrls:[void 0]},c=[];function d(e){const s={a:"a",admonition:"admonition",code:"code",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsxs)(s.p,{children:["This action assumes the ",(0,t.jsx)(s.a,{href:"https://yarnpkg.com/",children:"yarn package manager"})," is used."]})}),"\n",(0,t.jsxs)(s.p,{children:["Cypress E2E action offers an easy way to automate, customize, and execute ",(0,t.jsx)(s.strong,{children:"parallel"})," end-to-end tests. The action\nprovides"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["dependency installation via ",(0,t.jsx)(s.strong,{children:"yarn"}),","]}),"\n",(0,t.jsx)(s.li,{children:"scanning of test specs,"}),"\n",(0,t.jsx)(s.li,{children:"running each spec in parallel, and"}),"\n",(0,t.jsx)(s.li,{children:"upload test screenshots and video on test failure."}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"The example below is a very simple setup:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Install Cypress with ",(0,t.jsx)(s.code,{children:"yarn add cypress --dev"})]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Initialize Cypress with ",(0,t.jsx)(s.code,{children:"yarn run cypress open"})]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.a,{href:"https://qubitpi.github.io/cypress-documentation/guides/tooling/typescript-support/",children:"Support TypeScript"})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Put all ",(0,t.jsx)(s.strong,{children:".spec.cy.ts"}),' test files under "cypress/e2e" directory']}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Install ",(0,t.jsx)(s.a,{href:"https://www.npmjs.com/package/wait-on",children:"wait-on"}),": ",(0,t.jsx)(s.code,{children:"yarn add -D wait-on"})]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Add the following script command to ",(0,t.jsx)(s.code,{children:"package.json"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n  ...\n\n  "scripts": {\n    "e2e": "cypress run --browser chrome",\n    "wait-on-dev": "wait-on http-get://localhost:3000/",\n    "wait-on-prod": "wait-on http-get://localhost:3000/"\n  },\n\n  ...\n}\n'})}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsx)(s.p,{children:"Note that we assume the UI is running at port 3000. Please adjust it accordingly if it's running at a different port."})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Use Cypress E2E Tests workflow:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:'---\nname: CI/CD\n\n"on":\n  pull_request:\n  push:\n    branches:\n      - master\n\n  e2e-tests:\n    name: Unit Tests\n    needs: unit-tests\n    uses: QubitPi/hashicorp-aws/.github/workflows/cypress-e2e.yml@master\n'})}),"\n",(0,t.jsxs)(s.p,{children:["In the example above, the node 18 is used in the CI/CDed project by default. A list of custom node versions can be\nused to replace the default. For example, to run E2E tests in node 16, 18, and 20, simply use ",(0,t.jsx)(s.strong,{children:"node-versions"}),"\nparameter:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:'---\n  e2e-tests:\n    name: Unit Tests\n    needs: unit-tests\n    uses: QubitPi/hashicorp-aws/.github/workflows/cypress-e2e.yml@master\n    with:\n      node-versions: \'["16", "18", "20"]\'\n'})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.admonition,{type:"tip",children:[(0,t.jsxs)(s.p,{children:["Inside the ",(0,t.jsx)(s.code,{children:"cypress-e2e"})," workflow, each [Cypress spec] is tested in 2 modes:"]}),(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"yarn-start"}),": the web app is started using ",(0,t.jsx)(s.code,{children:"yarn start"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"server"}),": a production build is generated first using ",(0,t.jsx)(s.code,{children:"yarn build"})," and then the web app is started with\n",(0,t.jsx)(s.code,{children:"yarn serve"})]}),"\n"]}),(0,t.jsx)(s.p,{children:"The reason we run the same E2E in 2 separate modes is that we assume E2E testing consists of 2 logical parts:"}),(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"The logical tests defined by Cypress spec files"}),"\n",(0,t.jsx)(s.li,{children:"The same tests in the context of integration of web app logic and the production runtime github-actions-core"}),"\n"]}),(0,t.jsxs)(s.p,{children:["The app may work perfectly fine in E2E, but it's a different question when the same app is packaged up using,\nfor example, ",(0,t.jsx)(s.a,{href:"https://webpack.js.org/",children:"webpack"}),". The later could also be interpreted as integration tests against\nwebpack configuration which makes the tests more comprehensive"]})]})]})}function p(e={}){const{wrapper:s}={...(0,i.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},5639:(e,s,n)=>{n.d(s,{Z:()=>o,a:()=>a});var t=n(1733);const i={},r=t.createContext(i);function a(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);